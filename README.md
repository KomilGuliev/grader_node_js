# External Grader for programming in C

## Описание
Внешний грейдер для проверки портивных задач на языке программирования С. ПРинцип работы грейдера заключается в том что, оно проверяет список своих проектов на новые изменения через определенный отрезок времени.
Задачи проверяются синхронным образом, то есть грейдер в одно время может принимать только одну задачу на проверку. В ходе проверки грейдер выставляет оценку в классрум, если студент присоединился к нужному курсу, в противном случае не выставляется оценка. Грейдер возвращает подробные коментарии к задаче в zulip, если студент имеет аккаунт в zulip, по его почте ао которой было создано задача.

***ВАЖНО:***
> 	*Прежде чем ставит задачки с помощью грейдера, убедитесь что по заданному **email** существует аккаунты **gitlab**, **zulip**, **cassroom**, также не забывайте присоединится к курсу в классруме по которой ставится задача.*

## Оглавление
* [Описание](#Описание)
* [Оглавление](#Оглавление)
* [Установка](#Установка)
* [Архитектура грейдера](#Архитектура грейдера)


## Установка
Скоро

##Архитектура грейдера
В проекте используются 4 разных API, такие как Classroom API(Google), Directory API(Google), Gitlab API и API группового чата Zulip. Принцип работы проекта заключается в том что оно протестирует программы написанные студентами, и отдает полный анализ кода. Грейдер запускается на удаленном сервере, и у него есть внутренние и внешние конфигурации. Внешные конфигурация будет находится на отдельной репозитории в gitlab. В конфигурации указывается полная информация о созданных проектов и информация о вариантах задач. Грейдер отслеживает те проекты которые у него есть в конфигурации. В информации о проектах входит:
	- gmail-почта студента
	- имя студента
	- идентификатор круса в classroom
	- идентификатор курсовой работы
	- идентификатор проекта в gitlab.
	- время создания проекта (unix timestamp
	- продолжительность отслеживания в секундах
	- дата последнего обновления (unix timestamp)
	- вариант задачи
Во внутренних конфигурации проекта входит файл по адресу configs/global.js в котором указывается токен для работы с gitlab, домен gitlab, идентификатор репозиторий где указаны внешние конфигурации, также шаблоны сообщений. Также есть файлы для получения доступа к внешним API:
- 	**zuliprc** - доступ к генеративному боту в zulip
- 	**credentials.json** - доступ к API google
- 	**token.json** - токен по котором происходит общения с google API. Создается динамически исходя из credentials.josn


##Управление грейдером

В файле package.json указывается нужные пакеты, которые необходимы для корректной работы грейдера. При установки npm все указанные пакеты устанавливаются автоматический. Также в ней указанный нужные команды грейдера. Шаблон команды выглядит таким образом **npm run #command**. Команды по которым работает грейдер:

**start** - запускает сам грейдер, и оно будет работать до тех пор пока принудительно не остановят ее
**create** - создает задачи для студентов. Поддерживает ряд аргументов:
- **--gmail** -  создает задачу для студента с заданным gmail
- **--task-variant** - указывается вариант задачи
- **--task-type** - указывает тип задач
- **--group** - указывается группа для которых будет создано задачки (только образовательные группы МИЭМ)
- **--limit** - указывается продолжительность отслеживания в миллисекундах. Время считается с даты создания проекта в гитлаб. По умолчанию лимит имеет отрицательное значение и проект будет отслеживаться до тех пор пока ее не удалят.
- **--course-id** - идентификатор существующего курса в classroom
- **--course-title** - создать курс с таким названием
- **--cw-id** - идентификатор существующей курсовой работы
- **--cw-title** - создать курсовую работу с заданным названием


***Примечания ***
>-  Если задан **gmail**, игнорируется группа.
- Если вариант задан то для группы или студента создается задача с таким вариантом и игнорируется тип задач.
- Если не указан тип задач, то по умолчанию задачи выбираются на юнит-тестах.
- Если не указан лимит времени для отслеживания то, по умолчанию устанавливается на час (3600 * 1000 милисекунд).
- Если идентификатор курса задан, то игнорируется названия курса и не создается новый курс. По умолчанию если не указан названия нового курса, устанавливается курс по умолчанию.
- Если задан идентификатор существующего курсовой работы, то игнорируется название новой курсовой работы.
- По умолчанию курсовая работа называется “Экзамен”
- По умолчанию используется префикс “exam” для проектов в **gitlab**.

**get** - получит список созданных задач. Поддерживает ряд аргументов:
- **--gmail** - получает список проектов принадлежащих студенту с указанным gmail
- **--task-variant** - список проектов по варианту
- **--course-id** - идентификатор существующего курса в classroom
- **--task-type** - список проектов по типу задач
- **--group** - проекты для заданной группы
- **--git-prefix** - проекты начинающийся с заданным префиксом
- **--pr-ids** - проекты с заданными идентификаторами в гитлаб
- **--cw-title** - проекты где название курсовой работы равняется заданному названию
- **--cw-ids** - проекты где идентификатор курсовой работы входи в заданных идентификаторах (Пример --cw-ids=”1 2 3”)
- **--active** - активные проекты. Активным проектом считается проект для которого выставляется оценки в classroom. 
- **--not-active** - неактивные проекты. Проекты которые отслеживаются но для них не выставляется оценка в classroom. Общение происходит только с чатом zulip.

**delete** - удалить созданные проекты. Поддерживает ряд аргументов:
- **--gmail** - все проекты принадлежащие студенту по заданному gmail
- **--git-prefix** - все проекты начинающийся с заданным префиксом
- **--cw-id** - все проекты где идентификатор курсовой работы равно заданному
- **--cw-title** - все проекты где название курсовой работы совпадает заданному
- **--pr-ids** - все проекты с заданными идентификаторами в gitlab
- **--all** - все проекты
- **--not-active** - все неактивные проекты
- **--active** - все активные проекты
